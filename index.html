<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chai Club Widget</title>
<style>
  body{font-family:Arial,sans-serif;padding:20px;max-width:800px;margin:auto}
  h3,h4{text-align:center}
  .box{
    color:#333;padding:10px;margin:5px;border-radius:8px;
    min-width:120px;text-align:center;font-weight:bold;display:inline-block
  }
</style>
</head>
<body>

<h3>Thank You to Our Chai Club Members!</h3>
<div id="donorContainer"></div>

<p style="text-align:center;margin-top:20px">
  Your ongoing support sustains our community.<br>
  Together, we're making a difference every month.<br>
  Join today and add your name here!
</p>

<script>
/* ---------- CONFIG ---------- */
const urlBase =
  'https://script.google.com/macros/s/AKfycbyGyU_iURa2yZplO1KT5RRLWDTKWJUTowKiffJ12T_dxxBnpkNKlfJwK8Tqsz5P9eU/exec';

const tierColors = {
  Platinum:'#e5e4e2',
  Gold    :'#ffd700',
  Silver  :'#c0c0c0',
  Bronze  :'#cd7f32'
};
/* ---------- JSONP HELPER ---------- */
function jsonp(url){
  return new Promise((resolve,reject)=>{
    const cb = 'jsonp_cb_'+Date.now();
    window[cb] = data => { delete window[cb]; script.remove(); resolve(data); };
    const script = document.createElement('script');
    script.src = url + (url.includes('?')?'&':'?') + 'callback=' + cb;
    script.onerror = () => { delete window[cb]; script.remove(); reject(); };
    document.body.appendChild(script);
  });
}
/* ---------- RENDER HELPERS ---------- */
function makeRow(list,tier){
  let html = `<h4>${tier} Members</h4><div>`;
  list.forEach(n=>{
    html += `<div class="box" style="background:${tierColors[tier]}">${n}</div>`;
  });
  for(let i=list.length;i<list.length+3;i++){
    html += '<div class="box" style="visibility:hidden">x</div>';
  }
  return html + '</div>';
}
async function render(){
  try{
    const data  = await jsonp(urlBase);
    const tiers = ['Platinum','Gold','Silver','Bronze'];
    const c     = document.getElementById('donorContainer');
    c.innerHTML = '';
    tiers.forEach(t => c.innerHTML += makeRow(data[t]||[],t));
  }catch(err){
    console.error('Unable to load Chai‑Club data',err);
  }
}
/* ---------- INIT ---------- */
render();
setInterval(render,30_000);   /* update every 30 s */
</script>

</body>
</html>
